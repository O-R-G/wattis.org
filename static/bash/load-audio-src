#!/bin/bash

# helper for wattis.org sounds
# read all filenames in a /media/audio/live/
# and generate code to populate javascript array
# writes to js file in /static/js/

IN=/Library/Webserver/Documents/wattis.local/media/audio/live/
OUT=/Library/Webserver/Documents/wattis.local/static/js/audio-src.js
ARRAY=""
PRE=$'/* automatically generated by /static/bash/load-audio */'
HEAD=$'var audio_src = [\n'
FOOT=$'];'

while [ "$1" != "" ]; do
    case $1 in
        -i | --in )             shift
                                IN=$1;;
        -h | --help )           echo -e "\
Usage: ./_p!kg [OPTION]... [FILE]...
Read *.mp3 files in directory and populate javascript array code.\
Write result to stdout.\

  -i, --in              input directory
"
        exit;;
    esac
    shift
done

echo "** start **"

cd $IN
ARRAY+=$PRE
ARRAY+=$HEAD

for FILE in *.mp3; do
    if [ -f "$FILE" ]; then

        # $"" allows for \n
        # must echo with "" also

        ARRAY+=$"    \"/media/audio/live/"
        ARRAY+=$FILE
        ARRAY+=$'\",\n'
    fi
done

ARRAY+=$FOOT
echo "$ARRAY" > $OUT
cat $OUT

echo "** done **"
exit









